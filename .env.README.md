# GuÃ­a de ConfiguraciÃ³n de Variables de Entorno

## ğŸ“ Estructura de Archivos .env

Tu proyecto tiene **DOS aplicaciones separadas**, cada una con su propio archivo `.env`:

```
raisket-fintech/
â”œâ”€â”€ .env.local              â† Frontend (Next.js)
â”œâ”€â”€ .env.local.example      â† Template del frontend
â””â”€â”€ raisket-backend/
    â”œâ”€â”€ .env                â† Backend (FastAPI)
    â””â”€â”€ .env.example        â† Template del backend
```

---

## ğŸ¯ Frontend: `.env.local`

**UbicaciÃ³n**: `/raisket-fintech/.env.local`

### Â¿QuÃ© hace el frontend?
- Muestra el marketplace de productos financieros
- Gestiona autenticaciÃ³n de usuarios (Google OAuth)
- Lee/escribe productos en Supabase
- Se conecta al backend para el chat con IA

### Variables Necesarias

| Variable | PropÃ³sito | DÃ³nde obtenerla |
|----------|-----------|-----------------|
| `NEXT_PUBLIC_SUPABASE_URL` | URL de tu proyecto Supabase | [Supabase Dashboard](https://supabase.com/dashboard) â†’ Settings â†’ API |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Key pÃºblica de Supabase | Supabase Dashboard â†’ Settings â†’ API |
| `SUPABASE_SERVICE_ROLE_KEY` | Key privada (solo scripts) | Supabase Dashboard â†’ Settings â†’ API |
| `NEXT_PUBLIC_GOOGLE_CLIENT_ID` | ID de OAuth de Google | [Google Cloud Console](https://console.cloud.google.com) â†’ APIs & Services â†’ Credentials |
| `GOOGLE_CLIENT_SECRET` | Secret de OAuth de Google | Google Cloud Console |
| `NEXT_PUBLIC_API_URL` | URL del backend FastAPI | Local: `http://localhost:8000` / ProducciÃ³n: URL de Railway |

### âš ï¸ Importante sobre `NEXT_PUBLIC_*`
Las variables que empiezan con `NEXT_PUBLIC_` se **exponen al navegador**. Son accesibles desde el cÃ³digo cliente.

**NUNCA** pongas keys privadas con el prefijo `NEXT_PUBLIC_`.

---

## ğŸ”§ Backend: `.env`

**UbicaciÃ³n**: `/raisket-fintech/raisket-backend/.env`

### Â¿QuÃ© hace el backend?
- Maneja el chat con IA usando Claude
- Realiza bÃºsqueda semÃ¡ntica con RAG (Pinecone)
- Proporciona API REST para el frontend

### Variables Necesarias

| Variable | PropÃ³sito | DÃ³nde obtenerla |
|----------|-----------|-----------------|
| `ANTHROPIC_API_KEY` | API de Claude para chat IA | [Anthropic Console](https://console.anthropic.com) |
| `OPENAI_API_KEY` | API de OpenAI (fallback) | [OpenAI Platform](https://platform.openai.com/api-keys) |
| `PINECONE_API_KEY` | Vector database para RAG | [Pinecone](https://www.pinecone.io) |
| `PINECONE_INDEX_NAME` | Nombre del Ã­ndice | `raisket-knowledge-base` |
| `CORS_ORIGINS` | Dominios permitidos | URLs de tu frontend |

### ConfiguraciÃ³n del Modelo LLM

```env
DEFAULT_MODEL=claude-3-5-sonnet-20241022  # Modelo a usar
MAX_TOKENS=4096                           # Tokens mÃ¡ximos de respuesta
TEMPERATURE=0.7                           # Creatividad (0-1)
```

---

## ğŸ”„ Flujo de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USUARIO                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FRONTEND (Next.js :3000)                        â”‚
â”‚              .env.local                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ NEXT_PUBLIC_SUPABASE_URL                                 â”‚
â”‚  â€¢ NEXT_PUBLIC_SUPABASE_ANON_KEY                            â”‚
â”‚  â€¢ NEXT_PUBLIC_GOOGLE_CLIENT_ID                             â”‚
â”‚  â€¢ NEXT_PUBLIC_API_URL                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                              â”‚
           â”‚ Productos financieros        â”‚ Chat con IA
           â”‚                              â”‚
           â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SUPABASE           â”‚     â”‚  BACKEND (FastAPI :8000)     â”‚
â”‚   (PostgreSQL)       â”‚     â”‚  raisket-backend/.env        â”‚
â”‚                      â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ productos         â”‚     â”‚  â€¢ ANTHROPIC_API_KEY         â”‚
â”‚  â€¢ usuarios          â”‚     â”‚  â€¢ PINECONE_API_KEY          â”‚
â”‚  â€¢ reseÃ±as           â”‚     â”‚  â€¢ DEFAULT_MODEL             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚                â”‚
                                   â”‚                â”‚
                                   â–¼                â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  CLAUDE  â”‚    â”‚  PINECONE    â”‚
                           â”‚   API    â”‚    â”‚  (Vectores)  â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ConfiguraciÃ³n Inicial RÃ¡pida

### 1. Frontend

```bash
# 1. Copiar el template
cp .env.local.example .env.local

# 2. Editar .env.local y agregar:
# - Credenciales de Supabase (de tu dashboard)
# - Credenciales de Google OAuth (de Google Cloud Console)
# - URL del backend: http://localhost:8000 (desarrollo)

# 3. Instalar dependencias
npm install

# 4. Ejecutar
npm run dev
```

### 2. Backend

```bash
# 1. Ir al directorio del backend
cd raisket-backend

# 2. Copiar el template
cp .env.example .env

# 3. Editar .env y agregar:
# - ANTHROPIC_API_KEY (de Anthropic Console)
# - PINECONE_API_KEY (de Pinecone Dashboard)
# - OPENAI_API_KEY (opcional, de OpenAI)

# 4. Crear entorno virtual
python -m venv venv
source venv/bin/activate  # Mac/Linux
# o
venv\Scripts\activate     # Windows

# 5. Instalar dependencias
pip install -r requirements.txt

# 6. Ejecutar
uvicorn app.main:app --reload
```

---

## âœ… Checklist de VerificaciÃ³n

### Frontend
- [ ] `.env.local` existe y tiene todas las variables
- [ ] Supabase URL y keys configuradas
- [ ] Google OAuth configurado
- [ ] `NEXT_PUBLIC_API_URL` apunta a `http://localhost:8000`
- [ ] Frontend corre en `http://localhost:3000`

### Backend
- [ ] `.env` existe en `raisket-backend/`
- [ ] `ANTHROPIC_API_KEY` configurada
- [ ] `PINECONE_API_KEY` configurada
- [ ] Ãndice de Pinecone creado (`raisket-knowledge-base`)
- [ ] Backend corre en `http://localhost:8000`
- [ ] DocumentaciÃ³n API disponible en `http://localhost:8000/docs`

---

## ğŸ”’ Seguridad

### âŒ NUNCA hagas commit de:
- `.env.local`
- `raisket-backend/.env`

### âœ… SÃ haz commit de:
- `.env.local.example`
- `raisket-backend/.env.example`

### Verificar `.gitignore`

AsegÃºrate de que tu `.gitignore` incluya:

```gitignore
# Environment variables
.env
.env.local
.env*.local
raisket-backend/.env
```

---

## ğŸ†˜ Troubleshooting

### "Failed to save .env.local: The content is newer"
- Ocurre cuando el archivo fue modificado externamente
- **SoluciÃ³n**: Usa "Compare" o "Overwrite" en VSCode

### "CORS error" en el chat
- Verifica que `CORS_ORIGINS` en el backend incluya `http://localhost:3000`

### "Supabase connection error"
- Verifica que `NEXT_PUBLIC_SUPABASE_URL` y `NEXT_PUBLIC_SUPABASE_ANON_KEY` sean correctas

### "Anthropic API error"
- Verifica que `ANTHROPIC_API_KEY` sea vÃ¡lida en el backend
- Revisa que tengas crÃ©ditos en tu cuenta de Anthropic

---

## ğŸ“ Recursos

- [Supabase Dashboard](https://supabase.com/dashboard)
- [Anthropic Console](https://console.anthropic.com)
- [Pinecone Console](https://app.pinecone.io)
- [Google Cloud Console](https://console.cloud.google.com)
- [OpenAI Platform](https://platform.openai.com)
