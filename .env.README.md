# Guía de Configuración de Variables de Entorno

## 📁 Estructura de Archivos .env

Tu proyecto tiene **DOS aplicaciones separadas**, cada una con su propio archivo `.env`:

```
raisket-fintech/
├── .env.local              ← Frontend (Next.js)
├── .env.local.example      ← Template del frontend
└── raisket-backend/
    ├── .env                ← Backend (FastAPI)
    └── .env.example        ← Template del backend
```

---

## 🎯 Frontend: `.env.local`

**Ubicación**: `/raisket-fintech/.env.local`

### ¿Qué hace el frontend?
- Muestra el marketplace de productos financieros
- Gestiona autenticación de usuarios (Google OAuth)
- Lee/escribe productos en Supabase
- Se conecta al backend para el chat con IA

### Variables Necesarias

| Variable | Propósito | Dónde obtenerla |
|----------|-----------|-----------------|
| `NEXT_PUBLIC_SUPABASE_URL` | URL de tu proyecto Supabase | [Supabase Dashboard](https://supabase.com/dashboard) → Settings → API |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Key pública de Supabase | Supabase Dashboard → Settings → API |
| `SUPABASE_SERVICE_ROLE_KEY` | Key privada (solo scripts) | Supabase Dashboard → Settings → API |
| `NEXT_PUBLIC_GOOGLE_CLIENT_ID` | ID de OAuth de Google | [Google Cloud Console](https://console.cloud.google.com) → APIs & Services → Credentials |
| `GOOGLE_CLIENT_SECRET` | Secret de OAuth de Google | Google Cloud Console |
| `NEXT_PUBLIC_API_URL` | URL del backend FastAPI | Local: `http://localhost:8000` / Producción: URL de Railway |

### ⚠️ Importante sobre `NEXT_PUBLIC_*`
Las variables que empiezan con `NEXT_PUBLIC_` se **exponen al navegador**. Son accesibles desde el código cliente.

**NUNCA** pongas keys privadas con el prefijo `NEXT_PUBLIC_`.

---

## 🔧 Backend: `.env`

**Ubicación**: `/raisket-fintech/raisket-backend/.env`

### ¿Qué hace el backend?
- Maneja el chat con IA usando Claude
- Realiza búsqueda semántica con RAG (Pinecone)
- Proporciona API REST para el frontend

### Variables Necesarias

| Variable | Propósito | Dónde obtenerla |
|----------|-----------|-----------------|
| `ANTHROPIC_API_KEY` | API de Claude para chat IA | [Anthropic Console](https://console.anthropic.com) |
| `OPENAI_API_KEY` | API de OpenAI (fallback) | [OpenAI Platform](https://platform.openai.com/api-keys) |
| `PINECONE_API_KEY` | Vector database para RAG | [Pinecone](https://www.pinecone.io) |
| `PINECONE_INDEX_NAME` | Nombre del índice | `raisket-knowledge-base` |
| `CORS_ORIGINS` | Dominios permitidos | URLs de tu frontend |

### Configuración del Modelo LLM

```env
DEFAULT_MODEL=claude-3-5-sonnet-20241022  # Modelo a usar
MAX_TOKENS=4096                           # Tokens máximos de respuesta
TEMPERATURE=0.7                           # Creatividad (0-1)
```

---

## 🔄 Flujo de Datos

```
┌─────────────────────────────────────────────────────────────┐
│                         USUARIO                              │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│              FRONTEND (Next.js :3000)                        │
│              .env.local                                      │
├─────────────────────────────────────────────────────────────┤
│  • NEXT_PUBLIC_SUPABASE_URL                                 │
│  • NEXT_PUBLIC_SUPABASE_ANON_KEY                            │
│  • NEXT_PUBLIC_GOOGLE_CLIENT_ID                             │
│  • NEXT_PUBLIC_API_URL                                      │
└──────────┬──────────────────────────────┬───────────────────┘
           │                              │
           │ Productos financieros        │ Chat con IA
           │                              │
           ▼                              ▼
┌──────────────────────┐     ┌──────────────────────────────┐
│   SUPABASE           │     │  BACKEND (FastAPI :8000)     │
│   (PostgreSQL)       │     │  raisket-backend/.env        │
│                      │     ├──────────────────────────────┤
│  • productos         │     │  • ANTHROPIC_API_KEY         │
│  • usuarios          │     │  • PINECONE_API_KEY          │
│  • reseñas           │     │  • DEFAULT_MODEL             │
└──────────────────────┘     └─────┬────────────────┬───────┘
                                   │                │
                                   │                │
                                   ▼                ▼
                           ┌──────────┐    ┌──────────────┐
                           │  CLAUDE  │    │  PINECONE    │
                           │   API    │    │  (Vectores)  │
                           └──────────┘    └──────────────┘
```

---

## 🚀 Configuración Inicial Rápida

### 1. Frontend

```bash
# 1. Copiar el template
cp .env.local.example .env.local

# 2. Editar .env.local y agregar:
# - Credenciales de Supabase (de tu dashboard)
# - Credenciales de Google OAuth (de Google Cloud Console)
# - URL del backend: http://localhost:8000 (desarrollo)

# 3. Instalar dependencias
npm install

# 4. Ejecutar
npm run dev
```

### 2. Backend

```bash
# 1. Ir al directorio del backend
cd raisket-backend

# 2. Copiar el template
cp .env.example .env

# 3. Editar .env y agregar:
# - ANTHROPIC_API_KEY (de Anthropic Console)
# - PINECONE_API_KEY (de Pinecone Dashboard)
# - OPENAI_API_KEY (opcional, de OpenAI)

# 4. Crear entorno virtual
python -m venv venv
source venv/bin/activate  # Mac/Linux
# o
venv\Scripts\activate     # Windows

# 5. Instalar dependencias
pip install -r requirements.txt

# 6. Ejecutar
uvicorn app.main:app --reload
```

---

## ✅ Checklist de Verificación

### Frontend
- [ ] `.env.local` existe y tiene todas las variables
- [ ] Supabase URL y keys configuradas
- [ ] Google OAuth configurado
- [ ] `NEXT_PUBLIC_API_URL` apunta a `http://localhost:8000`
- [ ] Frontend corre en `http://localhost:3000`

### Backend
- [ ] `.env` existe en `raisket-backend/`
- [ ] `ANTHROPIC_API_KEY` configurada
- [ ] `PINECONE_API_KEY` configurada
- [ ] Índice de Pinecone creado (`raisket-knowledge-base`)
- [ ] Backend corre en `http://localhost:8000`
- [ ] Documentación API disponible en `http://localhost:8000/docs`

---

## 🔒 Seguridad

### ❌ NUNCA hagas commit de:
- `.env.local`
- `raisket-backend/.env`

### ✅ SÍ haz commit de:
- `.env.local.example`
- `raisket-backend/.env.example`

### Verificar `.gitignore`

Asegúrate de que tu `.gitignore` incluya:

```gitignore
# Environment variables
.env
.env.local
.env*.local
raisket-backend/.env
```

---

## 🆘 Troubleshooting

### "Failed to save .env.local: The content is newer"
- Ocurre cuando el archivo fue modificado externamente
- **Solución**: Usa "Compare" o "Overwrite" en VSCode

### "CORS error" en el chat
- Verifica que `CORS_ORIGINS` en el backend incluya `http://localhost:3000`

### "Supabase connection error"
- Verifica que `NEXT_PUBLIC_SUPABASE_URL` y `NEXT_PUBLIC_SUPABASE_ANON_KEY` sean correctas

### "Anthropic API error"
- Verifica que `ANTHROPIC_API_KEY` sea válida en el backend
- Revisa que tengas créditos en tu cuenta de Anthropic

---

## 📞 Recursos

- [Supabase Dashboard](https://supabase.com/dashboard)
- [Anthropic Console](https://console.anthropic.com)
- [Pinecone Console](https://app.pinecone.io)
- [Google Cloud Console](https://console.cloud.google.com)
- [OpenAI Platform](https://platform.openai.com)
